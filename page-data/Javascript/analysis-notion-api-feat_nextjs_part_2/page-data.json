{"componentChunkName":"component---src-templates-blog-post-js","path":"/Javascript/analysis-notion-api-feat_nextjs_part_2/","result":{"data":{"site":{"siteMetadata":{"author":"JaeSeoKim","comment":{"utterances":"JaeSeoKim/jaeseokim.github.io"},"sponsor":{"buyMeACoffeeId":"jaeseokim"}}},"markdownRemark":{"excerpt":"✍️ 이전 1편 읽으러 가기! 하위 Notion Block 불러오기! 저번에 간단하게 만들어둔 Block Rendering 부분에서 Child Component 를 Rendering 하는 부분은 코드 상으로 존재하지만 notion 의 응답이 실제 typedef 된 부분과 다르기 때문에 아래의 함수를 만들어서 재귀를 돌려 하위 child blocks 모두 불…","html":"<p><a href=\"/Javascript/analysis-notion-api-feat_nextjs_part_1/\">✍️ 이전 1편 읽으러 가기!</a></p>\n<h3 id=\"하위-notion-block-불러오기\" style=\"position:relative;\"><a href=\"#%ED%95%98%EC%9C%84-notion-block-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0\" aria-label=\"하위 notion block 불러오기 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하위 Notion Block 불러오기!</h3>\n<p>저번에 간단하게 만들어둔 <code>Block Rendering</code> 부분에서 <code>Child Component</code> 를 Rendering 하는 부분은 코드 상으로 존재하지만 <code>notion</code> 의 응답이 실제 <code>typedef</code> 된 부분과 다르기 때문에 아래의 함수를 만들어서 재귀를 돌려 하위 <code>child blocks</code> 모두 불러올 수 있도록 만들었습니다.</p>\n<p>typescript의 type 때문에 코드가 조금 길게 작성되었습니다. (개선 하시는 방법을 아시는 분은 댓글로 알려주세요!)</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"ts\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">blocks</span><span class=\"mtk1\">: </span><span class=\"mtk11\">Block</span><span class=\"mtk1\">[]) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Promise</span><span class=\"mtk1\">.</span><span class=\"mtk3\">all</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">blocks</span><span class=\"mtk1\">.</span><span class=\"mtk3\">map</span><span class=\"mtk1\">(</span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">block</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlockWithChildren</span><span class=\"mtk1\">(</span><span class=\"mtk4\">block</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlockWithChildren</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">block</span><span class=\"mtk1\">: </span><span class=\"mtk11\">Block</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk4\">has_children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk7\">true</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocks</span><span class=\"mtk1\">(</span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">switch</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk4\">type</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;paragraph&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">paragraph</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;undefined&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">paragraph</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\">(</span><span class=\"mtk4\">children</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;bulleted_list_item&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">bulleted_list_item</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;undefined&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">bulleted_list_item</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">children</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;numbered_list_item&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">numbered_list_item</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;undefined&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">numbered_list_item</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">children</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;to_do&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">to_do</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;undefined&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">to_do</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\">(</span><span class=\"mtk4\">children</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;toggle&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toggle</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;undefined&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toggle</span><span class=\"mtk1\">.</span><span class=\"mtk4\">children</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\">(</span><span class=\"mtk4\">children</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">block</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>이제 <code>next.js</code> 의 <code>getStaticProps</code> 를 아래와 같이 수정함으로 하위 Block 모두를 가지고 온 정보를 담을 수 있게 하였습니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"tsx\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getStaticProps</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">_ctx</span><span class=\"mtk1\">: </span><span class=\"mtk11\">GetStaticPropsContext</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk4\">process</span><span class=\"mtk1\">.</span><span class=\"mtk7\">env</span><span class=\"mtk1\">.</span><span class=\"mtk4\">NOTION_INDEX_PAGE</span><span class=\"mtk1\"> </span><span class=\"mtk8\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;string&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk10\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Error</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;Missing NOTION_INDEX_PAGE environment variable&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">page</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getPage</span><span class=\"mtk1\">(</span><span class=\"mtk4\">process</span><span class=\"mtk1\">.</span><span class=\"mtk7\">env</span><span class=\"mtk1\">.</span><span class=\"mtk4\">NOTION_INDEX_PAGE</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">blocks</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocks</span><span class=\"mtk1\">(</span><span class=\"mtk4\">process</span><span class=\"mtk1\">.</span><span class=\"mtk7\">env</span><span class=\"mtk1\">.</span><span class=\"mtk4\">NOTION_INDEX_PAGE</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">blocksWithAllChildren</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\">(</span><span class=\"mtk4\">blocks</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">props</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">page</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">blocks</span><span class=\"mtk1\">: </span><span class=\"mtk4\">blocksWithAllChildren</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">revalidate</span><span class=\"mtk1\">: </span><span class=\"mtk7\">64</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"nextjs-pages-api-만들기\" style=\"position:relative;\"><a href=\"#nextjs-pages-api-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"nextjs pages api 만들기 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js pages API 만들기!</h3>\n<p>이전에 <code>Notion mention</code> 에서 <code>page.id</code>, <code>database.id</code> 만을 가지고 있으니 이 때 필요한 정보를 가져올 수 있는 API를 작성 했습니다.</p>\n<p><code>end-point</code> 를 실제 notion과 유사하게 설정을 하였습니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"ts\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\">// pages/api/pages/[page_id].ts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">APIErrorCode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">ClientErrorCode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">isNotionClientError</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">Page</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client/build/src/api-types&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">type</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">NextApiRequest</span><span class=\"mtk1\">, </span><span class=\"mtk4\">NextApiResponse</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;next&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">getPage</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../lib/notion&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">type</span><span class=\"mtk1\"> </span><span class=\"mtk11\">GetPagesResData</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">error</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">page</span><span class=\"mtk1\">: </span><span class=\"mtk11\">Page</span><span class=\"mtk1\"> | </span><span class=\"mtk11\">null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">code</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">ClientErrorCode</span><span class=\"mtk1\"> | </span><span class=\"mtk11\">APIErrorCode</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getHandler</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiRequest</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiResponse</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GetPagesResData</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">page_id</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">req</span><span class=\"mtk1\">.</span><span class=\"mtk4\">query</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">page</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getPage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk4\">page_id</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;string&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk10\">?</span><span class=\"mtk1\"> </span><span class=\"mtk4\">page_id</span><span class=\"mtk1\"> </span><span class=\"mtk10\">:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">page_id</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">res</span><span class=\"mtk1\">.</span><span class=\"mtk3\">status</span><span class=\"mtk1\">(</span><span class=\"mtk7\">200</span><span class=\"mtk1\">).</span><span class=\"mtk3\">json</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">page</span><span class=\"mtk1\">: </span><span class=\"mtk4\">page</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } </span><span class=\"mtk10\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">e</span><span class=\"mtk1\">: </span><span class=\"mtk11\">unknown</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk3\">isNotionClientError</span><span class=\"mtk1\">(</span><span class=\"mtk4\">e</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk11\">res</span><span class=\"mtk1\">.</span><span class=\"mtk3\">status</span><span class=\"mtk1\">(</span><span class=\"mtk7\">500</span><span class=\"mtk1\">).</span><span class=\"mtk3\">json</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">page</span><span class=\"mtk1\">: </span><span class=\"mtk7\">null</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">error</span><span class=\"mtk1\">: </span><span class=\"mtk11\">e</span><span class=\"mtk1\">.</span><span class=\"mtk4\">message</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">code</span><span class=\"mtk1\">: </span><span class=\"mtk11\">e</span><span class=\"mtk1\">.</span><span class=\"mtk4\">code</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">else</span><span class=\"mtk1\"> </span><span class=\"mtk10\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk4\">e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">handler</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiRequest</span><span class=\"mtk1\">, </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiResponse</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">switch</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">req</span><span class=\"mtk1\">.</span><span class=\"mtk4\">method</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;GET&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getHandler</span><span class=\"mtk1\">(</span><span class=\"mtk4\">req</span><span class=\"mtk1\">, </span><span class=\"mtk4\">res</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">default</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">default</span><span class=\"mtk1\"> </span><span class=\"mtk4\">handler</span></span></span></code></pre>\n<p>이제 <code>metion</code> 부분에서 <code>swr</code> 를 이용하여 정보를 <code>fetch</code> 하고 받아오는 로직을 추가 합니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"tsx\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">PageMention</span><span class=\"mtk1\"> </span><span class=\"mtk10\">as</span><span class=\"mtk1\"> </span><span class=\"mtk4\">PageMentionType</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client/build/src/api-types&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">Link</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;next/link&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">classes</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../lib/classes&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">useRequest</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../lib/hooks/useRequest&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">getTitleFromPage</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../lib/notion&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">GetPagesResData</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../pages/api/pages/[page_id]&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PageMentionProps</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">mention</span><span class=\"mtk1\">: </span><span class=\"mtk11\">PageMentionType</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">className</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">PageMention</span><span class=\"mtk1\">: </span><span class=\"mtk11\">React</span><span class=\"mtk1\">.</span><span class=\"mtk11\">FC</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">PageMentionProps</span><span class=\"mtk1\">&gt; </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> ({ </span><span class=\"mtk4 mtki\">mention</span><span class=\"mtk1\">, </span><span class=\"mtk4 mtki\">className</span><span class=\"mtk1\"> }) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">page</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">mention</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">data</span><span class=\"mtk1\">, </span><span class=\"mtk11\">error</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">useRequest</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GetPagesResData</span><span class=\"mtk1\">&gt;({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">url</span><span class=\"mtk1\">: </span><span class=\"mtk6\">`/api/pages/</span><span class=\"mtk10\">${</span><span class=\"mtk11\">page</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">error</span><span class=\"mtk1\"> </span><span class=\"mtk8\">||</span><span class=\"mtk1\"> </span><span class=\"mtk11\">data</span><span class=\"mtk1\">?.</span><span class=\"mtk4\">page</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk7\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk11\">Link</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">href</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk6\">`/pages/</span><span class=\"mtk10\">${</span><span class=\"mtk11\">page</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk4\">a</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk4\">className</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;requests fail: </span><span class=\"mtk10\">{</span><span class=\"mtk11\">page</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&lt;/</span><span class=\"mtk4\">a</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk11\">Link</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">data</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk7\">undefined</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk11\">Link</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">href</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk6\">`/pages/</span><span class=\"mtk10\">${</span><span class=\"mtk11\">page</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk4\">a</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk4\">className</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">title</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk6\">`loading-page-</span><span class=\"mtk10\">${</span><span class=\"mtk11\">page</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          Loading 📡</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;/</span><span class=\"mtk4\">a</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk11\">Link</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">title</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getTitleFromPage</span><span class=\"mtk1\">(</span><span class=\"mtk11\">data</span><span class=\"mtk1\">.</span><span class=\"mtk4\">page</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk11\">Link</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">href</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk6\">`/pages/</span><span class=\"mtk10\">${</span><span class=\"mtk11\">page</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk4\">a</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk4\">className</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">title</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk4\">title</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">{</span><span class=\"mtk4\">title</span><span class=\"mtk10\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk4\">a</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk11\">Link</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">default</span><span class=\"mtk1\"> </span><span class=\"mtk4\">PageMention</span></span></span></code></pre>\n<p>이때 <code>next/link</code> 를 이용하여 <code>/pages/[page_id]</code> 로 이동하도록 만들어 두었는데 해당 page를 만들어 봅니다.</p>\n<h3 id=\"nextjs-getstaticpaths-fallback를-이용한-notion-pages-rendering\" style=\"position:relative;\"><a href=\"#nextjs-getstaticpaths-fallback%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-notion-pages-rendering\" aria-label=\"nextjs getstaticpaths fallback를 이용한 notion pages rendering permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js getStaticPaths fallback를 이용한 notion pages rendering</h3>\n<p><code>next.js</code> 에서 제공하는 강력한 기능중 하나인 <code>getStaticPaths</code> <code>fallback: true</code> 옵션을 통해서 요청이 들어오면 <code>SSG</code> 를 작동하도록 만듭니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"tsx\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">GetStaticPropsContext</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;next&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">Head</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;next/head&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">useRouter</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;next/router&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">Block</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../components/notion/Block&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">Block</span><span class=\"mtk1\"> </span><span class=\"mtk10\">as</span><span class=\"mtk1\"> </span><span class=\"mtk4\">BlockType</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client/build/src/api-types&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">PagesRetrieveResponse</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client/build/src/api-endpoints&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">classes</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../lib/classes&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">getBlocks</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">getBlocksWithChildren</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">getPage</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">getTitleFromPage</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../lib/notion&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">Loading</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../components/Loding&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getStaticPaths</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">paths</span><span class=\"mtk1\">: [], </span><span class=\"mtk4\">fallback</span><span class=\"mtk1\">: </span><span class=\"mtk7\">true</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getStaticProps</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4 mtki\">ctx</span><span class=\"mtk1\">: </span><span class=\"mtk11\">GetStaticPropsContext</span><span class=\"mtk1\">&lt;{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">page_id</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">page_id</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ctx</span><span class=\"mtk1\">.</span><span class=\"mtk4\">params</span><span class=\"mtk8\">!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">page</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getPage</span><span class=\"mtk1\">(</span><span class=\"mtk4\">page_id</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">blocks</span><span class=\"mtk1\">, </span><span class=\"mtk11\">next_cursor</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocks</span><span class=\"mtk1\">(</span><span class=\"mtk4\">page_id</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">blocksWithAllChildren</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getBlocksWithChildren</span><span class=\"mtk1\">(</span><span class=\"mtk4\">blocks</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">props</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">page</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">blocks</span><span class=\"mtk1\">: </span><span class=\"mtk4\">blocksWithAllChildren</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">revalidate</span><span class=\"mtk1\">: </span><span class=\"mtk7\">64</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } </span><span class=\"mtk10\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">error</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">notFound</span><span class=\"mtk1\">: </span><span class=\"mtk7\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">PageByIdPage</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> ({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">page</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">blocks</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">page</span><span class=\"mtk1\">: </span><span class=\"mtk11\">PagesRetrieveResponse</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">blocks</span><span class=\"mtk1\">: </span><span class=\"mtk11\">BlockType</span><span class=\"mtk1\">[]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">isFallback</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">useRouter</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">isFallback</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk11\">Loading</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk6\">&quot;container&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk6\">&quot;min-w-screen-md&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk6\">&quot;min-h-screen&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk6\">&quot;mx-auto&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk6\">&quot;w-8&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ])</span><span class=\"mtk10\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      /&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">title</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getTitleFromPage</span><span class=\"mtk1\">(</span><span class=\"mtk4\">page</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk4\">div</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk6\">&quot;container&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;max-w-screen-md&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;mx-auto&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;px-2&quot;</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk11\">Head</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk4\">title</span><span class=\"mtk1\">&gt;</span><span class=\"mtk10\">{</span><span class=\"mtk4\">title</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&lt;/</span><span class=\"mtk4\">title</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk11\">Head</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk4\">article</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk4\">h1</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk6\">&quot;text-4xl&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;py-3&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;font-bold&quot;</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;</span><span class=\"mtk10\">{</span><span class=\"mtk4\">title</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&lt;/</span><span class=\"mtk4\">h1</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk4\">hr</span><span class=\"mtk1\"> /&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">{</span><span class=\"mtk11\">blocks</span><span class=\"mtk1\">.</span><span class=\"mtk3\">map</span><span class=\"mtk1\">((</span><span class=\"mtk4 mtki\">block</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          &lt;</span><span class=\"mtk11\">Block</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">key</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk6\">`</span><span class=\"mtk10\">${</span><span class=\"mtk11\">block</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">-</span><span class=\"mtk10\">${new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Date</span><span class=\"mtk1\">()</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk10\">}</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">value</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk4\">block</span><span class=\"mtk10\">}</span><span class=\"mtk1\"> /&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ))</span><span class=\"mtk10\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk4\">article</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk4\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">default</span><span class=\"mtk1\"> </span><span class=\"mtk4\">PageByIdPage</span></span></span></code></pre>\n<p><code>next/router</code> 의 <code>useRouter</code> hook를 이용하여 <code>isFallback</code> 에 대한 경우를 체크를 하여 Loading를 하도록 처리를 해두고 만약 <code>getStaticProps</code> 에서 <code>notFound</code> 가 true로 응답이 오게 되면 자동으로 404로 연결이 됩니다.</p>\n<p>이방법을 사용하게 되면 <code>getServerSideProps</code> 와 같은 작업은 무조건 매요청마다 <code>SSR</code> 작업을 수행하지만 이 방식을 사용하게 되면 요청이 들어왔을 때 없었던 요청이면 <code>SSG</code> 작업을 거치고 응답을 해주고 아니라면 미리 사전에 렌더링 된 HTML을 응답하여 빠른 속도로 처리가 가능합니다.</p>\n<p><img src=\"/8ef26b1ff2ca5bc4075fb6449a5a3ce8/getStaticPath-fallback.gif\" alt=\"getStaticPaths fallback\"></p>\n<p>실제로 <code>vercel</code> 를 통해 deploy 한 결과물의 동작은 지연이 없이 매우 부드럽게 동작하는 것을 볼 수 있습니다!</p>\n<h3 id=\"nextjs-databases-api-만들기\" style=\"position:relative;\"><a href=\"#nextjs-databases-api-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"nextjs databases api 만들기 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js databases API 만들기!</h3>\n<p>이제 <code>Database</code> 관한 정보를 가져오는 API를 만들어 봅니다!</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"ts\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\">// pages/api/databases/[database_id].ts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">APIErrorCode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">ClientErrorCode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">isNotionClientError</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">Database</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client/build/src/api-types&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">type</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">NextApiRequest</span><span class=\"mtk1\">, </span><span class=\"mtk4\">NextApiResponse</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;next&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">getDatabase</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../lib/notion&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">type</span><span class=\"mtk1\"> </span><span class=\"mtk11\">GetDatabasesResData</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">error</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">database</span><span class=\"mtk1\">: </span><span class=\"mtk11\">Database</span><span class=\"mtk1\"> | </span><span class=\"mtk11\">null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">code</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">ClientErrorCode</span><span class=\"mtk1\"> | </span><span class=\"mtk11\">APIErrorCode</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getHandler</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiRequest</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiResponse</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GetDatabasesResData</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">database_id</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">req</span><span class=\"mtk1\">.</span><span class=\"mtk4\">query</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">database</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getDatabase</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">typeof</span><span class=\"mtk1\"> </span><span class=\"mtk4\">database_id</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;string&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk10\">?</span><span class=\"mtk1\"> </span><span class=\"mtk4\">database_id</span><span class=\"mtk1\"> </span><span class=\"mtk10\">:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">database_id</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">res</span><span class=\"mtk1\">.</span><span class=\"mtk3\">status</span><span class=\"mtk1\">(</span><span class=\"mtk7\">200</span><span class=\"mtk1\">).</span><span class=\"mtk3\">json</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">database</span><span class=\"mtk1\">: </span><span class=\"mtk4\">database</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } </span><span class=\"mtk10\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">e</span><span class=\"mtk1\">: </span><span class=\"mtk11\">unknown</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk3\">isNotionClientError</span><span class=\"mtk1\">(</span><span class=\"mtk4\">e</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk11\">res</span><span class=\"mtk1\">.</span><span class=\"mtk3\">status</span><span class=\"mtk1\">(</span><span class=\"mtk7\">500</span><span class=\"mtk1\">).</span><span class=\"mtk3\">json</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">database</span><span class=\"mtk1\">: </span><span class=\"mtk7\">null</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">error</span><span class=\"mtk1\">: </span><span class=\"mtk11\">e</span><span class=\"mtk1\">.</span><span class=\"mtk4\">message</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">code</span><span class=\"mtk1\">: </span><span class=\"mtk11\">e</span><span class=\"mtk1\">.</span><span class=\"mtk4\">code</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">else</span><span class=\"mtk1\"> </span><span class=\"mtk10\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk4\">e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">handler</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiRequest</span><span class=\"mtk1\">, </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiResponse</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">switch</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">req</span><span class=\"mtk1\">.</span><span class=\"mtk4\">method</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;GET&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getHandler</span><span class=\"mtk1\">(</span><span class=\"mtk4\">req</span><span class=\"mtk1\">, </span><span class=\"mtk4\">res</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">default</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">default</span><span class=\"mtk1\"> </span><span class=\"mtk4\">handler</span></span></span></code></pre>\n<p>위와 같이 API를 구현하였으니 <code>PageMention</code> 과 동일하게 <code>DatabaseMention</code> 도 API와 연결 합니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"tsx\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">DatabaseMention</span><span class=\"mtk1\"> </span><span class=\"mtk10\">as</span><span class=\"mtk1\"> </span><span class=\"mtk4\">DatabaseMentionType</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client/build/src/api-types&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">classes</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../lib/classes&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">useRequest</span><span class=\"mtk1\"> </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../lib/hooks/useRequest&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">GetDatabasesResData</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../pages/api/databases/[database_id]&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">interface</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DatabaseMentionProps</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">mention</span><span class=\"mtk1\">: </span><span class=\"mtk11\">DatabaseMentionType</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">className</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">DatabaseMention</span><span class=\"mtk1\">: </span><span class=\"mtk11\">React</span><span class=\"mtk1\">.</span><span class=\"mtk11\">FC</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">DatabaseMentionProps</span><span class=\"mtk1\">&gt; </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> ({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">mention</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">className</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">database</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">mention</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">data</span><span class=\"mtk1\">, </span><span class=\"mtk11\">error</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">useRequest</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GetDatabasesResData</span><span class=\"mtk1\">&gt;({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">url</span><span class=\"mtk1\">: </span><span class=\"mtk6\">`/api/databases/</span><span class=\"mtk10\">${</span><span class=\"mtk11\">database</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">error</span><span class=\"mtk1\"> </span><span class=\"mtk8\">||</span><span class=\"mtk1\"> </span><span class=\"mtk11\">data</span><span class=\"mtk1\">?.</span><span class=\"mtk4\">database</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk7\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk4\">span</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk4\">className</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;requests fail: </span><span class=\"mtk10\">{</span><span class=\"mtk11\">database</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&lt;/</span><span class=\"mtk4\">span</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">data</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk7\">undefined</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk4\">span</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk4\">className</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7 mtki\">title</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk6\">`loading-database-</span><span class=\"mtk10\">${</span><span class=\"mtk11\">database</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk10\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        Loading 📡</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk4\">span</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">title</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">data</span><span class=\"mtk1\">.</span><span class=\"mtk11\">database</span><span class=\"mtk1\">.</span><span class=\"mtk11\">title</span><span class=\"mtk1\">.</span><span class=\"mtk3\">map</span><span class=\"mtk1\">((</span><span class=\"mtk4 mtki\">value</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">value</span><span class=\"mtk1\">.</span><span class=\"mtk4\">plain_text</span><span class=\"mtk1\">).</span><span class=\"mtk3\">join</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk4\">span</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">className</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk3\">classes</span><span class=\"mtk1\">([</span><span class=\"mtk4\">className</span><span class=\"mtk1\">])</span><span class=\"mtk10\">}</span><span class=\"mtk1\"> </span><span class=\"mtk7 mtki\">title</span><span class=\"mtk8\">=</span><span class=\"mtk10\">{</span><span class=\"mtk4\">title</span><span class=\"mtk10\">}</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">{</span><span class=\"mtk4\">title</span><span class=\"mtk10\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk4\">span</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">default</span><span class=\"mtk1\"> </span><span class=\"mtk4\">DatabaseMention</span></span></span></code></pre>\n<p>그리고 해당 <code>Database</code> 에 대한 종속 <code>pages</code> 정보를 가져오는 API도 작성을 합니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"ts\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\">// pages/api/databases/[database_id]/pages.ts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">APIErrorCode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">ClientErrorCode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">isNotionClientError</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">Page</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;@notionhq/client/build/src/api-types&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> </span><span class=\"mtk4\">type</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">NextApiRequest</span><span class=\"mtk1\">, </span><span class=\"mtk4\">NextApiResponse</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;next&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">getDatabasePages</span><span class=\"mtk1\"> } </span><span class=\"mtk10\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;../../../../lib/notion&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">type</span><span class=\"mtk1\"> </span><span class=\"mtk11\">GetDatabasesPagesResData</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">error</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">pages</span><span class=\"mtk1\">: </span><span class=\"mtk11\">Page</span><span class=\"mtk1\">[] | </span><span class=\"mtk11\">null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">code</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">ClientErrorCode</span><span class=\"mtk1\"> | </span><span class=\"mtk11\">APIErrorCode</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">next_cursor</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span><span class=\"mtk1\"> | </span><span class=\"mtk11\">null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">type</span><span class=\"mtk1\"> </span><span class=\"mtk11\">GetDatabasesPagesReqData</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">database_id</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">start_cursor</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">page_size</span><span class=\"mtk10\">?</span><span class=\"mtk1\">: </span><span class=\"mtk11\">string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getHandler</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiRequest</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiResponse</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GetDatabasesPagesResData</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">database_id</span><span class=\"mtk1\">, </span><span class=\"mtk11\">start_cursor</span><span class=\"mtk1\">, </span><span class=\"mtk11\">page_size</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">req</span><span class=\"mtk1\">.</span><span class=\"mtk4\">query</span><span class=\"mtk1\"> </span><span class=\"mtk10\">as</span><span class=\"mtk1\"> </span><span class=\"mtk11\">unknown</span><span class=\"mtk1\"> </span><span class=\"mtk10\">as</span><span class=\"mtk1\"> </span><span class=\"mtk11\">GetDatabasesPagesReqData</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">pages</span><span class=\"mtk1\">, </span><span class=\"mtk11\">next_cursor</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getDatabasePages</span><span class=\"mtk1\">(</span><span class=\"mtk4\">database_id</span><span class=\"mtk1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">start_cursor</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">page_size</span><span class=\"mtk1\">: </span><span class=\"mtk11\">Number</span><span class=\"mtk1\">(</span><span class=\"mtk4\">page_size</span><span class=\"mtk1\">) </span><span class=\"mtk8\">||</span><span class=\"mtk1\"> </span><span class=\"mtk7\">50</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">res</span><span class=\"mtk1\">.</span><span class=\"mtk3\">status</span><span class=\"mtk1\">(</span><span class=\"mtk7\">200</span><span class=\"mtk1\">).</span><span class=\"mtk3\">json</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">pages</span><span class=\"mtk1\">: </span><span class=\"mtk4\">pages</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">next_cursor</span><span class=\"mtk1\">: </span><span class=\"mtk4\">next_cursor</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } </span><span class=\"mtk10\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">e</span><span class=\"mtk1\">: </span><span class=\"mtk11\">unknown</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk3\">isNotionClientError</span><span class=\"mtk1\">(</span><span class=\"mtk4\">e</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk11\">res</span><span class=\"mtk1\">.</span><span class=\"mtk3\">status</span><span class=\"mtk1\">(</span><span class=\"mtk7\">500</span><span class=\"mtk1\">).</span><span class=\"mtk3\">json</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">pages</span><span class=\"mtk1\">: </span><span class=\"mtk7\">null</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">next_cursor</span><span class=\"mtk1\">: </span><span class=\"mtk7\">null</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">error</span><span class=\"mtk1\">: </span><span class=\"mtk11\">e</span><span class=\"mtk1\">.</span><span class=\"mtk4\">message</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">code</span><span class=\"mtk1\">: </span><span class=\"mtk11\">e</span><span class=\"mtk1\">.</span><span class=\"mtk4\">code</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">else</span><span class=\"mtk1\"> </span><span class=\"mtk10\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk4\">e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> </span><span class=\"mtk3\">handler</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk10\">async</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiRequest</span><span class=\"mtk1\">, </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">: </span><span class=\"mtk11\">NextApiResponse</span><span class=\"mtk1\">) </span><span class=\"mtk10\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">switch</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">req</span><span class=\"mtk1\">.</span><span class=\"mtk4\">method</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">case</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;GET&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">return</span><span class=\"mtk1\"> </span><span class=\"mtk10\">await</span><span class=\"mtk1\"> </span><span class=\"mtk3\">getHandler</span><span class=\"mtk1\">(</span><span class=\"mtk4\">req</span><span class=\"mtk1\">, </span><span class=\"mtk4\">res</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">default</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">export</span><span class=\"mtk1\"> </span><span class=\"mtk10\">default</span><span class=\"mtk1\"> </span><span class=\"mtk4\">handler</span></span></span></code></pre>\n<p>이제 <code>Database</code> 부분을 가지고 렌더링 하는 부분은 다음편에 이어서 작성을 해보겠습니다.</p>\n<p>몇일에 걸쳐서 <code>Notion-api</code> 를 직접 사용해보니 여러가지 사용하기 편한 부분들이 많이 있어서 신기 했고 Beta가 끝나면 <code>oopy.io</code>, <code>super.so</code> 와 같은 서비스를 사용하지 않더라도 쉽게 나만의 <code>Notion Site</code> 를 만들 수 있을 것 같습니다.</p>\n<blockquote>\n<p>😸 Github Repo : <a href=\"https://github.com/JaeSeoKim/nextjs-notion-api-example\">https://github.com/JaeSeoKim/nextjs-notion-api-example</a></p>\n<p>Original Notion Page: <a href=\"https://www.notion.so/Notion-API-Next-js-INDEX-PAGE-13cb8d2d3328425e815a1896267f5906\">https://www.notion.so/Notion-API-Next-js-INDEX-PAGE-13cb8d2d3328425e815a1896267f5906</a></p>\n<p>Demo Site : <a href=\"https://nextjs-notion-api.vercel.app/\">https://nextjs-notion-api.vercel.app/</a></p>\n</blockquote>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .one-dark-pro {\n    background-color: #282c34;\n    color: #abb2bf;\n  }\n  .one-dark-pro .mtki { font-style: italic; }\n  .one-dark-pro .mtk10 { color: #C678DD; }\n  .one-dark-pro .mtk1 { color: #ABB2BF; }\n  .one-dark-pro .mtk3 { color: #61AFEF; }\n  .one-dark-pro .mtk8 { color: #56B6C2; }\n  .one-dark-pro .mtk4 { color: #E06C75; }\n  .one-dark-pro .mtk11 { color: #E5C07B; }\n  .one-dark-pro .mtk7 { color: #D19A66; }\n  .one-dark-pro .mtk6 { color: #98C379; }\n  .one-dark-pro .mtk5 { color: #7F848E; }\n  .one-dark-pro .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"/Javascript/analysis-notion-api-feat_nextjs_part_2/#%ED%95%98%EC%9C%84-notion-block-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0\">하위 Notion Block 불러오기!</a></li>\n<li><a href=\"/Javascript/analysis-notion-api-feat_nextjs_part_2/#nextjs-pages-api-%EB%A7%8C%EB%93%A4%EA%B8%B0\">Next.js pages API 만들기!</a></li>\n<li><a href=\"/Javascript/analysis-notion-api-feat_nextjs_part_2/#nextjs-getstaticpaths-fallback%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-notion-pages-rendering\">Next.js getStaticPaths fallback를 이용한 notion pages rendering</a></li>\n<li><a href=\"/Javascript/analysis-notion-api-feat_nextjs_part_2/#nextjs-databases-api-%EB%A7%8C%EB%93%A4%EA%B8%B0\">Next.js databases API 만들기!</a></li>\n</ul>","frontmatter":{"date":"2021년 07월 26일","title":"Notion API 분석해보기!(feat. Next.js)(2)","tags":["notion","notion-api","next.js"]}}},"pageContext":{"slug":"/Javascript/analysis-notion-api-feat_nextjs_part_2/","previous":{"fields":{"slug":"/Javascript/analysis-notion-api-feat_nextjs_part_1/"},"frontmatter":{"title":"Notion API 분석해보기!(feat. Next.js)(1)"}},"next":null}},"staticQueryHashes":["1081905842","63159454"]}